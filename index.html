<!DOCTYPE html>
<title>Role randomizer</title>
<script>
	let htmlTable;
	let htmlTableHeaderRow;
	let htmlTableBodyRows;
	let htmlTableFooterRows;
	let roleResults = null;
	const roles = ["a", "2", "h", "c", "d"];
	const nameInputs = [];
	const roleInputs = [];
	const resultDatas = [];
	window.onload = function() {
		htmlTable = document.getElementById("table");
		htmlTableHeaderRow = htmlTable.firstElementChild.firstElementChild;
		htmlTableBodyRows = htmlTable.children[1].getElementsByTagName("tr");
		htmlTableFooterRows = htmlTable.children[2].getElementsByTagName("tr");
		generateTables();
	}
	function generateTables() {
		for (let i = 0; i < 5; ++i) {
			let row = htmlTableBodyRows[i];
			let nameData = document.createElement("td");
			let nameInput = document.createElement("input");
			nameInput.type = "text";
			nameInput.size = "10";
			nameInput.tabIndex = i + 1;
			nameInputs[i] = nameInput;
			nameData.append(nameInput);

			let roleData = document.createElement("td");
			let roleInput = document.createElement("input");
			roleInput.size = "5";
			roleInput.type = "text";
			roleInput.tabIndex = i + 6;
			roleInputs[i] = roleInput;
			let fillInput = document.createElement("input");
			fillInput.type = "button";
			fillInput.value = "R";
			fillInput.onclick = function() {
				roleInputs[i].value = "a2hcd";
			}
			roleData.append(roleInput);
			roleData.append(fillInput);
			row.append(nameData);
			row.append(roleData);
			if (i == 0) nameData.focus();
		}
		for (let i = 0; i < 2; ++i) {
			let data;
			if (i == 0) {
				data = document.createElement("th");
				data.innerHTML = "Result";
			} else {
				data = document.createElement("td");
				resultData = data;
			}
			data.colSpan = 3;
			htmlTableFooterRows[i].append(data);
		}
		resetRoles();
	}
	function solve() {
		let possible = [];
		for (let i = 0; i < 5; ++i) {
			if (roleInputs[0].value.toLowerCase().indexOf(roles[i]) < 0) continue;
			for (let j = 0; j < 5; ++j) {
				if (j == i || roleInputs[1].value.toLowerCase().indexOf(roles[j]) < 0) continue;
				for (let k = 0; k < 5; ++k) {
					if (k == i || k == j || roleInputs[2].value.toLowerCase().indexOf(roles[k]) < 0) continue;
					for (let l = 0; l < 5; ++l) {
						if (l == i || l == j || l == k || roleInputs[3].value.toLowerCase().indexOf(roles[l]) < 0) continue;
						for (let m = 0; m < 5; ++m) {
							if (m == i || m == j || m == k || m == l || roleInputs[4].value.toLowerCase().indexOf(roles[m]) < 0) continue;
							possible.push([i, j, k, l, m]);
						}
					}
				}
			}
		}
		if (possible.length > 0) {
			let chosenIndex = Math.floor(Math.random() * possible.length);
			roleResults = possible[chosenIndex];
			let result = "";
			for (let i = 0; i < 5; ++i) {
				for (let j = 0; j < 5; ++j) {
					if (roleResults[j] == i) {
						result += nameInputs[j].value
						if (i < 4) result += " ";
						break;
					}
				}
			}
			resultData.innerHTML = result;
		} else {
			resultData.innerHTML = "Impossible!"
		}
	}
	function resetRoles() {
		for (let i = 0; i < 5; ++i) {
			roleInputs[i].value = "a2hcd";
		}
	}
	function removePrevious() {
		if (!roleResults) return;

		for (let i = 0; i < 5; ++i) {
			let roleChar = roles[roleResults[i]];
			roleInputs[i].value = roleInputs[i].value.replace(new RegExp(roleChar, "gi"), "");
		}
	}
</script>
<style>
	table, th, td {
		border: 1px solid black;
		border-collapse: collapse;
	}
	th, td {
		padding: 2px 4px;
	}
	td {
		text-align: center;
	}
	button {
		margin-right: 4px;
		margin-top: 4px;
		padding: 2px;
	}
	#content {
		display: inline-block;
	}
	#randomize {
		font-weight: bold;
	}
	input[type="text"] {
		text-align: center;
	}
	input[type="button"] {
		margin-left: 4px;
	}
</style>
<body>
	<div id="content">
		<table id="table">
			<thead>
				<tr>
					<th>Name</th>
					<th>Roles</th>
				</tr>
			</thead>
			<tbody>
				<tr></tr><tr></tr><tr></tr><tr></tr><tr></tr>
			</tbody>
			<tfoot>
				<tr></tr><tr></tr>
			</tfoot>
		</table>
		<button id="randomize" tabIndex="11" onclick="solve()">Randomize!</button>
		<button onclick="removePrevious()">Remove Previous</button>
	</div>
</body>